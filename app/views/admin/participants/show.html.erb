<!--
Copyright (C) 2007, 2008, 2009, 2010 Heiko Bernloehr (FreeIT.de).

This file is part of ECS.

ECS is free software: you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of
the License, or (at your option) any later version.

ECS is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with ECS. If not, see <http://www.gnu.org/licenses/>.
-->


<h1 class="box1">Show Participant</h1>

<%= link_to 'Edit', edit_admin_participant_path(:id => @participant) %> |
<%= link_to 'Back', admin_participants_path %>

<p>
  <label class="box2 table-resource-label">Name:</label>
  <%= @participant.name %>
</p>

<p>
<div class="formular-input-width">
<div class="table-border">
<div class="table-header">
  <label class="table-resource-label">Description (optional):</label>
</div>
    <%= h(@participant.description).gsub(/\r\n/, '<BR>') %>
</div>
</div>
</p>

<p>
<div style="float:left;width:7ex">
  <label for="participant_dns" class="box2 table-resource-label">DNS:</label>
</div>
<%= @participant.dns %>
</p>

<p>
<div style="float:left;width:7ex">
  <label for="participant_email" class="box2 table-resource-label">Email:</label>
</div>
<%= @participant.email %>
</p>

<p>
  <label class="box2 table-resource-label">Organization:</label>
  <%= @participant.organization.orgtext %>
</p>

<p>
  <label class="box2 table-resource-label">Community Selfrouting:</label>
  <%= check_box_tag "participant[community_selfrouting]",1,@participant.community_selfrouting, :disabled => true %>
</p>

<p>
<div class="show-output-width">
<div class="table-border">
<div class="table-header">
  <label class="table-resource-label">Identities:</label>
</div>
  <table class="list" width="100%">
    <TR align="left">
      <TH>ID:</TH>
      <TH>Description:</TH>
    </TR>
    <% @participant.identities.each do |ident| %>
      <tr class="<%= cycle('list-line-odd', 'list-line-even') %>">
        <TD> <%= h ident.name %> </TD>
        <TD> <%= h(ident.description).gsub(/\r\n/, '<BR>') %> </TD>
      </TR>
    <% end %>
  </table>
</div>
</div>

<p>
<div class="show-output-width">
<div class="table-border">
<div class="table-header">
  <label class="table-resource-label">Communities:</label>
</div>
  <table class="list" width="100%">
    <TR align="left">
        <TH>Name:</TH>
        <TH>Description:</TH>
        <TH align="right">mid:&nbsp;</TH>
    </TR>
    <% @participant.communities.each do |comm| %>
      <tr class="<%= cycle('list-line-odd', 'list-line-even') %>">
        <TD> <%= link_to h(comm.name), admin_community_path(comm) %> </TD>
        <TD> <%= h(comm.description).gsub(/\r\n/, '<BR>') %> </TD>
        <TD align="right"> <%= Membership.for_participant_id_and_community_id(@participant.id, comm.id)[0].id.to_s %>&nbsp; </TD>
      </TR>
    <% end %>
  </table>
</div>
</div>
</p>

<p>
<%= link_to 'Edit', edit_admin_participant_path(:id => @participant) %> |
<%= link_to 'Back', admin_participants_path %>
</p>

<% unless (messages =  Message.for_participant_receiver(@participant).uniq).blank? %>
<p>
<div class="show-output-width">
<div class="table-border">
<div class="table-header">
  <label class="table-resource-label">Messages (Receiver):</label>
</div>
  <table class="list" width="100%">
    <TR align="left">
        <TH>Id:</TH>
        <TH>Resource:</TH>
        <TH>Content-Type:</TH>
        <TH>Date:</TH>
    </TR>
    <% messages.each do |message| %>
      <tr class="<%= cycle('list-line-odd', 'list-line-even') %>">
        <TD> <%= h message.id %> </TD>
        <TD> <%= h message.ressource.namespace+'/'+message.ressource.ressource %> </TD>
        <TD> <%= h message.content_type %> </TD>
        <TD> <%= h message.created_at %> </TD>
      </TR>
    <% end %>
  </table>
</div>
</div>
</p>
<% end %>

<% unless (messages =  Message.for_participant_sender(@participant).uniq).blank? %>
<p>
<div class="show-output-width">
<div class="table-border">
<div class="table-header">
  <label class="table-resource-label">Messages (Sender):</label>
</div>
  <table class="list" width="100%">
    <TR align="left">
        <TH>Id:</TH>
        <TH>Resource:</TH>
        <TH>Content-Type:</TH>
        <TH>Date:</TH>
    </TR>
    <% messages.each do |message| %>
      <tr class="<%= cycle('list-line-odd', 'list-line-even') %>">
        <TD> <%= h message.id %> </TD>
        <TD> <%= h message.ressource.namespace+'/'+message.ressource.ressource %> </TD>
        <TD> <%= h message.content_type %> </TD>
        <TD> <%= h message.created_at %> </TD>
      </TR>
    <% end %>
  </table>
</div>
</div>
</p>
<% end %>

<% unless (events =  Event.for_participant(@participant,-1).uniq).blank? %>
<p>
<div class="show-output-width">
<div class="table-border">
<div class="table-header">
  <label class="table-resource-label">Events:</label>
</div>
  <table class="list" width="100%">
    <TR align="left">
        <TH>Id:</TH>
        <TH>Message-Id:</TH>
        <TH>Event-Type:</TH>
        <TH>Date:</TH>
    </TR>
    <% events.each do |event| %>
      <tr class="<%= cycle('list-line-odd', 'list-line-even') %>">
        <TD> <%= h event.id %> </TD>
        <TD> <%= h event.message.id %> </TD>
        <TD> <%= h event.ev_type.name %> </TD>
        <TD> <%= h event.created_at %> </TD>
      </TR>
    <% end %>
  </table>
</div>
</div>
</p>
<% end %>
